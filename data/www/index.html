<!DOCTYPE html>
<meta charset="UTF-8">

<html>

<head>
    <link rel="stylesheet" type="text/css" href="/www/style.css">
    <!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
    <title>ESP32 HostPrint</title>
</head>

<body>
    <div id="container">
        <div id="pstatus" style="text-align: center;">
            <label id="lprintersts">Not Connected</label>
            <button id="abortbtn" onclick="abortPrint()">Abort Print</button>
            <div id="printprogress">
                <label id="lprintprg" for="prinprg"></label>
                <progress id="prinprg" value="0" max="100"></progress>
            </div>
        </div>
        <div id="navbuttons">
            <button class="tablink" onclick="openPage('controltab', this, 'rgb(85, 120, 141)')" >Control</button>
            <button class="tablink" onclick="openPage('filestab', this, 'rgb(85, 120, 141)')">Files</button>
            <button class="tablink" onclick="openPage('settingstab', this, 'rgb(85, 120, 141)')" id="defaultOpen">Settings</button>
            <button class="tablink" onclick="openPage('abouttab', this, 'rgb(85, 120, 141)')">About</button>
        </div>
        <div id="filestab" class="tabcontent">
            <div id="ftable" class="lockonprint">
                <div id="fileup">
                    <form class='form' enctype='multipart/form-data' id='uploadfrm' name='uploadform' method='POST'>
                        <input type='file' name='userfile' id='inpfile' onchange='sub(this, lInputFile)' />
                        <label id='linpfile' for='inpfile'>Browse</label>
                        <input type='submit' value='Upload' id = "uploadbtn"/>
                    </form>
                    <br><br>
                    <div id='prgtxt'></div>
                    <div id='prgbar'>
                        <div id='iprgbar'> </div>
                    </div>
                </div>
                <table id="tfiles" class="tfiles">
                    <thead id="tfileshead">
                        <tr>
                            <th id="thname" class="unselectable" unselectable="on">
                                <div id="refresh" onclick="getDirs()"> Refresh
                                    <svg fill="#ffff" viewBox="0 0 24 24" width="1em" height="1em">
                                        <path
                                            d="M 7.1601562 3 L 8.7617188 5 L 19 5 L 19 15 L 16 15 L 20 20 L 24 15 L 21 15 L 21 3 L 7.1601562 3 z M 4 4 L 0 9 L 3 9 L 3 21 L 16.839844 21 L 15.238281 19 L 5 19 L 5 9 L 8 9 L 4 4 z" />
                                    </svg>
                                </div>
                                <label>Files</label>
                            </th>
                            <th id="thprint" class="unselectable" unselectable="on">Print</th>
                            <th id="thsize" class="unselectable" unselectable="on">Size [MB]</th>
                            <th id="thdelete" class="unselectable" unselectable="on">Delete</th>
                        </tr>
                    </thead>
                    <tbody id="tbody"></tbody>
                </table>
            </div>
        </div>
        <div id="controltab" class="tabcontent">
            <div id="printerctrl">
                <div id="jogPanel" class="lockonprint">
                    <svg viewbox="0 0 410 230">
                        <defs>
                            <filter id="light">
                                <feGaussianBlur in="SourceAlpha" stdDeviation="2" result="out1" />
                                <feSpecularLighting in="out1" surfaceScale="8" specularConstant="2"
                                    specularExponent="12" result="out3">
                                    <feDistantLight azimuth="225" elevation="5" />
                                </feSpecularLighting>
                                <feComposite operator="in" in="out3" in2="SourceAlpha" result="out4" />
                                <feMerge>
                                    <feMergeNode in="SourceGraphic" />
                                    <feMergeNode in="out4" />
                                </feMerge>
                            </filter>

                            <filter id="shadow" width="200%" height="200%">
                                <feGaussianBlur in="SourceAlpha" stdDeviation="2" result="out1" />
                                <feOffset in="out1" dx="2" dy="2" result="out2" />
                                <feComposite in="SourceGraphic" in2="out2" operator="over" />
                            </filter>

                            <filter id="emboss" x0="-50%" y0="-50%" width="200%" height="200%">
                                <feMorphology in="SourceAlpha" operator="dilate" radius="1" />
                                <feGaussianBlur stdDeviation="1" result="blur" />

                                <feOffset dy="0.2" dx="0.2" />
                                <feComposite in2="SourceAlpha" operator="arithmetic" k2="1" k3="-1" result="hlDiff" />
                                <feFlood flood-color="white" flood-opacity=".7" />
                                <feComposite in2="hlDiff" operator="in" />
                                <feComposite in2="SourceGraphic" operator="over" result="withGlow" />

                                <feOffset in="blur" dy="-0.2" dx="-0.2" />
                                <feComposite in2="SourceAlpha" operator="arithmetic" k2="1" k3="-1"
                                    result="shadowDiff" />
                                <feFlood flood-color="black" flood-opacity="1" />
                                <feComposite in2="shadowDiff" operator="in" />
                                <feComposite in2="withGlow" operator="over" />
                            </filter>
                        </defs>
                        <g id="Jog" transform="translate(0,-30)">
                            <g id="homeall" transform="translate(10,175)" onclick="Command_Send('G28%0AM114',false);"
                                onmouseover="changecolor(ha1,ha2,ha3,ha4,'#2F65FF');"
                                onmouseout="changecolor(ha1,ha2,ha3,ha4,'#608B98');">
                                <circle cx='17' cy='17' r='18' fill='#FFF' />
                                <path class="bg" id="ha1"
                                    d="M1,15 L14,2 L16,1 L18,1 L20,2 L23,5 L23,2 L24,1 L27,1 L28,2 L28,10 L33,15 L30,18 L19,7 L15,7 L4,18 z"
                                    filter="url(#shadow)" />
                                <path class="bg" id="ha2"
                                    d="M1,15 L14,2 L16,1 L18,1 L20,2 L23,5 L23,2 L24,1 L27,1 L28,2 L28,10 L33,15 L30,18 L19,7 L15,7 L4,18 z"
                                    opacity='0.7' filter="url(#light)" />
                                <path class="bg" id="ha3" d="M6,19 L16,9 L18,9 L28,19 L28,28 L6,28 z"
                                    filter="url(#shadow)" />
                                <path class="bg" id="ha4" d="M6,19 L16,9 L18,9 L28,19 L28,28 L6,28 z"
                                    filter="url(#shadow)" opacity='0.7' filter="url(#light)" />
                            </g>

                            <g id="homex" transform="translate(10,35)" onclick="Command_Send('G28 X%0AM114',false);"
                                onmouseover="changecolor(hx1,hx2,hx3,hx4,'#2F65FF');"
                                onmouseout="changecolor(hx1,hx2,hx3,hx4,'#608B98');">
                                <circle cx='17' cy='17' r='18' fill='#FFF' />
                                <path class="bg" id="hx1"
                                    d="M1,15 L14,2 L16,1 L18,1 L20,2 L23,5 L23,2 L24,1 L27,1 L28,2 L28,10 L33,15 L30,18 L19,7 L15,7 L4,18 z"
                                    filter="url(#shadow)" />
                                <path class="bg" id="hx2"
                                    d="M1,15 L14,2 L16,1 L18,1 L20,2 L23,5 L23,2 L24,1 L27,1 L28,2 L28,10 L33,15 L30,18 L19,7 L15,7 L4,18 z"
                                    opacity='0.7' filter="url(#light)" />
                                <path class="bg" id="hx3" d="M6,19 L16,9 L18,9 L28,19 L28,28 L6,28 z"
                                    filter="url(#shadow)" />
                                <path class="bg" id="hx4" d="M6,19 L16,9 L18,9 L28,19 L28,28 L6,28 z"
                                    filter="url(#shadow)" opacity='0.7' filter="url(#light)" />
                                <text x="17" y="26" class="home">X</text>
                            </g>

                            <g id="homey" transform="translate(159,35)" onclick="Command_Send('G28 Y%0AM114',false);"
                                onmouseover="changecolor(hy1,hy2,hy3,hy4,'#2F65FF');"
                                onmouseout="changecolor(hy1,hy2,hy3,hy4,'#608B98');">
                                <circle cx='17' cy='17' r='18' fill='#FFF' />
                                <path class="bg" id="hy1"
                                    d="M1,15 L14,2 L16,1 L18,1 L20,2 L23,5 L23,2 L24,1 L27,1 L28,2 L28,10 L33,15 L30,18 L19,7 L15,7 L4,18 z"
                                    filter="url(#shadow)" />
                                <path class="bg" id="hy2"
                                    d="M1,15 L14,2 L16,1 L18,1 L20,2 L23,5 L23,2 L24,1 L27,1 L28,2 L28,10 L33,15 L30,18 L19,7 L15,7 L4,18 z"
                                    opacity='0.7' filter="url(#light)" />
                                <path class="bg" id="hy3" d="M6,19 L16,9 L18,9 L28,19 L28,28 L6,28 z"
                                    filter="url(#shadow)" />
                                <path class="bg" id="hy4" d="M6,19 L16,9 L18,9 L28,19 L28,28 L6,28 z"
                                    filter="url(#shadow)" opacity='0.7' filter="url(#light)" />
                                <text x="17" y="26" class="home">Y</text>
                            </g>

                            <g id="homez" transform="translate(159,175)" onclick="Command_Send('G28 Z%0AM114',false);"
                                onmouseover="changecolor(hz1,hz2,hz3,hz4,'#2F65FF');"
                                onmouseout="changecolor(hz1,hz2,hz3,hz4,'#608B98');">
                                <circle cx='17' cy='17' r='18' fill='#FFF' />
                                <path class="bg" id="hz1"
                                    d="M1,15 L14,2 L16,1 L18,1 L20,2 L23,5 L23,2 L24,1 L27,1 L28,2 L28,10 L33,15 L30,18 L19,7 L15,7 L4,18 z"
                                    filter="url(#shadow)" />
                                <path class="bg" id="hz2"
                                    d="M1,15 L14,2 L16,1 L18,1 L20,2 L23,5 L23,2 L24,1 L27,1 L28,2 L28,10 L33,15 L30,18 L19,7 L15,7 L4,18 z"
                                    opacity='0.7' filter="url(#light)" />
                                <path class="bg" id="hz3" d="M6,19 L16,9 L18,9 L28,19 L28,28 L6,28 z"
                                    filter="url(#shadow)" />
                                <path class="bg" id="hz4" d="M6,19 L16,9 L18,9 L28,19 L28,28 L6,28 z"
                                    filter="url(#shadow)" opacity='0.7' filter="url(#light)" />
                                <text x="17" y="26" class="home">Z</text>
                            </g>

                            <g id="topxy">
                                <path class="bg" d="M48,70 A 74,74 0 0,1 154,70 L126,98 A 35,35 0 0 0 76,98 z"
                                    filter="url(#shadow)" />
                                <path class="bg" d="M48,70 A 74,74 0 0,1 154,70 L126,98 A 35,35 0 0 0 76,98 z"
                                    opacity='0.7' filter="url(#light)" />
                                <path onclick="relMvCmd('Y-50');" onmouseover="settext_x('-50',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M48,70 A 74,74 0 0,1 154,70 L126,98 A 35,35 0 0 0 76,98 z" />
                                <path onclick="relMvCmd('Y-10');" onmouseover="settext_x('-10',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M55,77 A 64,64 0 0,1 147,77 L126,98 A 35,35 0 0 0 76,98 z" />
                                <path onclick="relMvCmd('Y-1');" onmouseover="settext_x('-1',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M62,84 A 54,54 0 0,1 140,84 L126,98 A 35,35 0 0 0 76,98 z" />
                                <path onclick="relMvCmd('Y-0.1');" onmouseover="settext_x('-0.1',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M69,91 A 44,44 0 0,1 133,91 L126,98 A 35,35 0 0 0 76,98 z" />
                                <path class='sign' d="M101,58 L112,76 L90,76 z" />
                            </g>

                            <g id="rightxy">
                                <path class="bg" d="M154,70 A 74,74 0 0,1 154,174 L126,146 A 35,35 0 0 0 126,98 z"
                                    filter="url(#shadow)" />
                                <path class="bg" d="M154,70 A 74,74 0 0,1 154,174 L126,146 A 35,35 0 0 0 126,98 z"
                                    opacity=0.7 filter="url(#light)" />
                                <path onclick="relMvCmd('X50');" onmouseover="settext_x('50',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M154,70 A 74,74 0 0,1 154,174 L126,146 A 35,35 0 0 0 126,98 z" />
                                <path onclick="relMvCmd('X10');" onmouseover="settext_x('10',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M147,77 A 64,64 0 0,1 147,167 L126,146 A 35,35 0 0 0 126,98 z" />
                                <path onclick="relMvCmd('X1');" onmouseover="settext_x('1',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M140,84 A 54,54 0 0,1 140,160 L126,146 A 35,35 0 0 0 126,98 z" />
                                <path onclick="relMvCmd('X0.1');" onmouseover="settext_x('0.1',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M133,91 A 44,44 0 0,1 133,153 L126,146 A 35,35 0 0 0 126,98 z" />
                                <path class='sign' d="M165,122 L148,112 L148,132 z" />
                            </g>

                            <g id="bottomxy">
                                <path class="bg" d="M48,174 A 74,74 0 0,0 154,174 L126,146 A 35,35 0 0 1 76,146 z"
                                    filter="url(#shadow)" />
                                <path class="bg" d="M48,174 A 74,74 0 0,0 154,174 L126,146 A 35,35 0 0 1 76,146 z"
                                    opacity='0.7' filter="url(#light)" />
                                <path onclick="relMvCmd('Y50');" onmouseover="settext_x('50',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M48,174 A 74,74 0 0,0 154,174 L126,146 A 35,35 0 0 1 76,146 z" />
                                <path onclick="relMvCmd('Y10');" onmouseover="settext_x('10',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M55,167 A 64,64 0 0,0 147,167 L126,146 A 35,35 0 0 1 76,146 z" />
                                <path onclick="relMvCmd('Y1');" onmouseover="settext_x('1',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M62,160 A 54,54 0 0,0 140,160 L126,146 A 35,35 0 0 1 76,146 z" />
                                <path onclick="relMvCmd('Y0.1');" onmouseover="settext_x('0.1',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M69,153 A 44,44 0 0,0 133,153 L126,146 A 35,35 0 0 1 76,146 z" />
                                <path class='sign' d="M101,186 L112,168 L90,168 z" />
                            </g>

                            <g id="leftxy">
                                <path class="bg" d="M48,174 A 74,74 0 0,1 48,70 L76,98 A 35,35 0 0 0 76,146 z" />
                                <path class="bg" d="M48,174 A 74,74 0 0,1 48,70 L76,98 A 35,35 0 0 0 76,146 z"
                                    opacity='0.7' filter="url(#light)" />
                                <path onclick="relMvCmd('X-50');" onmouseover="settext_x('-50',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M48,174 A 74,74 0 0,1 48,70 L76,98 A 35,35 0 0 0 76,146 z" />
                                <path onclick="relMvCmd('X-10');" onmouseover="settext_x('-10',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M55,167 A 64,64 0 0,1 55,77 L76,98 A 35,35 0 0 0 76,146 z" />
                                <path onclick="relMvCmd('X-1');" onmouseover="settext_x('-1',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M62,160 A 54,54 0 0,1 62,84 L76,98 A 35,35 0 0 0 76,146 z" />
                                <path onclick="relMvCmd('X-0.1');" onmouseover="settext_x('-0.1',this);"
                                    onmouseout="restore_x(this);" class="mskjog"
                                    d="M69,153 A 44,44 0 0,1 69,91 L76,98 A 35,35 0 0 0 76,146 z" />
                                <path class='sign' d="M37,122 L54,112 L54,132 z" />
                            </g>

                            <g id="centerxy">
                                <circle class="bg" cx="101" cy="122" r="34" />
                                <circle class=" bg" cx="101" cy="122" r="34" opacity='0.7' filter="url(#light)" />
                                <text id="centerxytext" class="centerjog" x="101" y="132">X/Y</text>
                            </g>

                            <g id="topz">
                                <path class="bg" d="M214,56 A 74,74 0 0,1 288,56 L268,92 A 35,35 0 0 0 234,92 z"
                                    filter="url(#shadow)" />
                                <path class="bg" d="M214,56 A 74,74 0 0,1 288,56 L268,92 A 35,35 0 0 0 234,92 z"
                                    opacity='0.7' filter="url(#light)" />
                                <path onclick="relMvCmd('Z10');" onmouseover="settext_z('10',this);"
                                    onmouseout="restore_z(this);" class="mskjog"
                                    d="M214,56 A 74,74 0 0,1 288,56 L268,92 A 35,35 0 0 0 234,92 z" />
                                <path onclick="relMvCmd('Z1');" onmouseover="settext_z('1',this);"
                                    onmouseout="restore_z(this);" class="mskjog"
                                    d="M219,65 A 64,64 0 0,1 283,65 L268,92 A 35,35 0 0 0 234,92 z" />
                                <path onclick="relMvCmd('Z0.1');" onmouseover="settext_z('0.1',this);"
                                    onmouseout="restore_z(this);" class="mskjog"
                                    d="M224,74 A 54,54 0 0,1 278,74 L268,92 A 35,35 0 0 0 234,92 z" />
                                <path onclick="relMvCmd('Z0.01');" onmouseover="settext_z('0.01',this);"
                                    onmouseout="restore_z(this);" class="mskjog"
                                    d="M229,83 A 44,44 0 0,1 273,83 L268,92 A 35,35 0 0 0 234,92 z" />
                                <path class='sign' d="M251,58 L262,76 L240,76 z" />
                            </g>

                            <g id="centerz">
                                <circle class="bg" cx="251" cy="122" r="34" filter="url(#shadow)" />
                                <circle class="bg" cx="251" cy="122" r="34" opacity='0.7' filter="url(#light)" />
                                <text id="centerztext" class="centerjog" x="251" y="132">Z</text>
                            </g>

                            <g id="bottomz">
                                <path class="bg" d="M214,188 A 75,75 0 0,0 288,188 L268,152 A 36,36 0 0 1 234,152 z"
                                    filter="url(#shadow)" />
                                <path class="bg" d="M214,188 A 75,75 0 0,0 288,188 L268,152 A 36,36 0 0 1 234,152 z"
                                    opacity='0.7' filter="url(#light)" />
                                <path onclick="relMvCmd('Z-10');" onmouseover="settext_z('-10',this);"
                                    onmouseout="restore_z(this);" class="mskjog"
                                    d="M214,188 A 74,74 0 0,0 288,188 L268,152 A 35,35 0 0 1 234,152 z" />
                                <path onclick="relMvCmd('Z-1');" onmouseover="settext_z('-1',this);"
                                    onmouseout="restore_z(this);" class="mskjog"
                                    d="M219,179 A 64,64 0 0,0 283,179 L268,152 A 35,35 0 0 1 234,152 z" />
                                <path onclick="relMvCmd('Z-0.1');" onmouseover="settext_z('-0.1',this);"
                                    onmouseout="restore_z(this);" class="mskjog"
                                    d="M224,170 A 54,54 0 0,0 278,170 L268,152 A 35,35 0 0 1 234,152 z" />
                                <path onclick="relMvCmd('Z-0.01');" onmouseover="settext_z('-0.01',this);"
                                    onmouseout="restore_z(this);" class="mskjog"
                                    d="M229,161 A 44,44 0 0,0 273,161 L268,152 A 35,35 0 0 1 234,152 z" />
                                <path class='sign' d="M251,186 L262,168 L240,168 z" />
                            </g>

                            <g id="tope">
                                <path class="bg" d="M317,56 A 74,74 0 0,1 391,56 L371,92 A 35,35 0 0 0 337,92 z"
                                    filter="url(#shadow)" />
                                <path class="bg" d="M317,56 A 74,74 0 0,1 391,56 L371,92 A 35,35 0 0 0 337,92 z"
                                    opacity='0.7' filter="url(#light)" />
                                <path onclick="relMvCmd('E-100');" onmouseover="settext_e('-100',this);"
                                    onmouseout="restore_e(this);" class="mskjog"
                                    d="M317,56 A 74,74 0 0,1 391,56 L371,92 A 35,35 0 0 0 337,92 z" />
                                <path onclick="relMvCmd('E-50');" onmouseover="settext_e('-50',this);"
                                    onmouseout="restore_e(this);" class="mskjog"
                                    d="M322,65 A 64,64 0 0,1 385,65 L371,92 A 35,35 0 0 0 337,92 z" />
                                <path onclick="relMvCmd('E-10');" onmouseover="settext_e('-10',this);"
                                    onmouseout="restore_e(this);" class="mskjog"
                                    d="M327,74 A 54,54 0 0,1 381,74 L371,92 A 35,35 0 0 0 337,92 z" />
                                <path onclick="relMvCmd('E-1');" onmouseover="settext_e('-1',this);"
                                    onmouseout="restore_e(this);" class="mskjog"
                                    d="M332,83 A 44,44 0 0,1 376,83 L371,92 A 35,35 0 0 0 337,92 z" />
                                <path class='sign' d="M354,58 L365,76 L343,76 z" />
                            </g>

                            <g id="centerze">
                                <circle class="bg" cx="354" cy="122" r="34" filter="url(#shadow)" />
                                <circle class="bg" cx="354" cy="122" r="34" class="bg" opacity='0.7'
                                    filter="url(#light)" />
                                <text id="centeretext" class="centerjog" x="353" y="132" opacity="0"></text>
                                <g id="extruder">
                                    <path class='sign' d="M350,108 L360,108 L360,128 L355,136 L350,128 z" />
                                    <path class='sign'
                                        d="M335,110 L338,109 L340,111 L341,111 L343,109 L346,110 L346,113 L349,113 L350,116 L348,118 L348,119 L350,121 L349,124 L346,124 L346,127 L343,128 L341,126 L340,126 L338,128 L335,127 L335,124 L332,124 L331,121 L333,119 L333,118 L331,116 L332,113 L335,113 z" />
                                    <circle cx="340.5" cy="118.5" r="3.5" fill="#608B98" />
                                </g>
                            </g>

                            <g id="bottome2">
                                <path class="bg" d="M317,188 A 74,74 0 0,0 354,197 L354,156.5 A 35,35 0 0 1 337,152 z"
                                    filter="url(#shadow)" />
                                <path class="bg" d="M317,188 A 74,74 0 0,0 354,197 L354,156.5 A 35,35 0 0 1 337,152 z"
                                    opacity='0.7' filter="url(#light)" />
                                <path onclick="relMvCmd('E100');" onmouseover="settext_e('100',this);"
                                    onmouseout="restore_e(this);" class="mskjog"
                                    d="M317,188 A 74,74 0 0,0 354,197 L354,156.5 A 35,35 0 0 1 337,152 z" />
                                <path onclick="relMvCmd('E50');" onmouseover="settext_e('50',this);"
                                    onmouseout="restore_e(this);" class="mskjog"
                                    d="M322,179 A 64,64 0 0,0 354,187 L354,156.5 A 35,35 0 0 1 337,152 z" />
                                <path onclick="relMvCmd('E10');" onmouseover="settext_e('10',this);"
                                    onmouseout="restore_e(this);" class="mskjog"
                                    d="M327,170 A 54,54 0 0,0 354,177 L354,156.5 A 35,35 0 0 1 337,152 z" />
                                <path onclick="relMvCmd('E1');" onmouseover="settext_e('1',this);"
                                    onmouseout="restore_e(this);" class="mskjog"
                                    d="M332,161 A 44,44 0 0,0 354,167 L354,156.5 A 35,35 0 0 1 337,152 z" />
                                <path class='sign' d="M337,171 L347,174 L339.5,182 z" />
                            </g>

                            <g id="bottome1">
                                <path class="bg" d="M354,197 A 74,74 0 0,0 391,188 L371,152 A 35,35 0 0 1 354,156.5 z"
                                    filter="url(#shadow)" />
                                <path class="bg" d="M354,197 A 74,74 0 0,0 391,188 L371,152 A 35,35 0 0 1 354,156.5 z"
                                    opacity='0.7' filter="url(#light)" />
                                <path onclick="relMvCmd('E100');;" onmouseover="settext_e('100',this);"
                                    onmouseout="restore_e(this);" class="mskjog"
                                    d="M354,197 A 74,74 0 0,0 391,188 L371,152 A 35,35 0 0 1 354,156.5 z" />
                                <path onclick="relMvCmd('E50');" onmouseover="settext_e('50',this);"
                                    onmouseout="restore_e(this);" class="mskjog"
                                    d="M354,187 A 64,64 0 0,0 386,179 L371,152 A 35,35 0 0 1 354,156.5 z" />
                                <path onclick="relMvCmd('E10');" onmouseover="settext_e('10',this);"
                                    onmouseout="restore_e(this);" class="mskjog"
                                    d="M354,177 A 54,54 0 0,0 381,170 L371,152 A 35,35 0 0 1 354,156.5 z" />
                                <path onclick="relMvCmd('E1');" onmouseover="settext_e('1',this);"
                                    onmouseout="restore_e(this);" class="mskjog"
                                    d="M354,167 A 54,54 0 0,0 376,161 L371,152 A 35,35 0 0 1 354,156.5 z" />
                                <path class='sign' d="M361,170 L372,167 L369.5,178 z" />
                                <path class='sign' d="M364,180 L375,177 L372,188 z" />
                            </g>

                            <g id="poweroff" transform="translate(11,220)" onclick="alert('power');"
                                onmouseover="changecolor(poweroff1,poweroff2,poweroff3,poweroff4,'#2F65FF');"
                                onmouseout="changecolor(poweroff1,poweroff2,poweroff3,poweroff4,'#608B98');">
                                <circle cx='17' cy='18' r='16' fill='#FFF' />
                                <path id="poweroff1" class="bg"
                                    d="M8,6 A15 15 0 1 0 26,6 A 3,3 0 0 0 22,10 A 10,10 0 1 1 12,10 A 3,3 0 0 0 8,6z"
                                    filter="url(#shadow)" />
                                <path id="poweroff2" class="bg"
                                    d="M8,6 A15 15 0 1 0 26,6 A 3,3 0 0 0 22,10 A 10,10 0 1 1 12,10 A 3,3 0 0 0 8,6z"
                                    opacity='0.7' filter="url(#light)" />
                                <path id="poweroff3" class="bg" d="M14,2 A4,4 0 0 1 20,2 L20,15 A4,4 0 0 1 14,15z"
                                    filter="url(#shadow)" />
                                <path id="poweroff4" class="bg" d="M14,2 A4,4 0 0 1 20,2 L20,15 A4,4 0 0 1 14,15z"
                                    opacity='0.7' filter="url(#light)" />
                            </g>

                            <g id="button_M" transform="translate(56,220)" onclick="Command_Send('M84',false);"
                                onmouseover="changecolor(buttonM1,buttonM2,buttonM3,buttonM4,buttonM5,buttonM6,'#2F65FF');"
                                onmouseout="changecolor(buttonM1,buttonM2,buttonM3,buttonM4,buttonM5,buttonM6,'#608B98');">
                                <circle cx='17' cy='18' r='16' fill='#FFF' />
                                <circle id="buttonM1" class='bg' cx="16" cy="16" r="15" filter="url(#shadow)" />
                                <circle id="buttonM2" class='bg' cx="16" cy="16" r="15" opacity='0.7'
                                    filter="url(#light)" />
                                <circle cx="16" cy="16" r="12" fill="white" stroke="#0D2F38" />
                                <path id="buttonM3" class="bg"
                                    d="M5,15 L9,15 L9,12 L11,10 L24,10 L25,11 L25,21 L24,22 L11,22 L9,20 L9,17 L5,17 z" />
                                <path id="buttonM4" class="bg"
                                    d="M5,15 L9,15 L9,12 L11,10 L24,10 L25,11 L25,21 L24,22 L11,22 L9,20 L9,17 L5,17 z"
                                    opacity='0.7' filter="url(#light)" />
                                <rect x="13" y="13" width="10" height="1" fill="white" stroke="none" />
                                <rect x="12" y="16" width="11" height="1" fill="white" stroke="none" />
                                <rect x="13" y="19" width="10" height="1" fill="white" stroke="none" />
                                <path id="buttonM5" d="M24,4 L4,24 L7,27 L27,7 z" fill="#608B98" stroke="none" />
                                <path id="buttonM6" d="M24,4 L4,24 L7,27 L27,7 z" fill="#608B98" stroke="none"
                                    opacity='0.7' filter="url(#light)" />
                                <line x1="22" y1="6" x2="6" y2="22" stroke="#0D2F38" />
                                <line x1="8" y1="25.5" x2="25.5" y2="8" stroke="#0D2F38" />
                            </g>

                            <g id="button_P" transform="translate(101,220)" onclick="alert('Button P');"
                                onmouseover="changecolor(buttonP1,buttonP2,'#2F65FF');"
                                onmouseout="changecolor(buttonP1,buttonP2,'#608B98');">
                                <circle cx='17' cy='18' r='16' fill='#FFF' />
                                <circle id="buttonP1" class='bg' cx="16" cy="16" r="15" filter="url(#shadow)" />
                                <circle id="buttonP2" class='bg' cx="16" cy="16" r="15" opacity='0.7'
                                    filter="url(#light)" />
                                <text class="textbutton" x="16" y="26" filter="url(#emboss)">P</text>
                            </g>

                            <g id="button_1" transform="translate(146,220)" onclick="alert('Button 1');"
                                onmouseover="changecolor(button11,button12,'#2F65FF');"
                                onmouseout="changecolor(button11,button12,'#608B98');">
                                <circle cx='17' cy='18' r='16' fill='#FFF' />
                                <circle id="button11" class='bg' cx="16" cy="16" r="15" filter="url(#shadow)" />
                                <circle id="button12" class='bg' cx="16" cy="16" r="15" opacity='0.7'
                                    filter="url(#light)" />
                                <text class="textbutton" x="16" y="26" filter="url(#emboss)">1</text>
                            </g>

                            <g id="button_2" transform="translate(191,220)" onclick="alert('Button 2');"
                                onmouseover="changecolor(button21,button22,'#2F65FF');"
                                onmouseout="changecolor(button21,button22,'#608B98');">
                                <circle cx='17' cy='18' r='16' fill='#FFF' />
                                <circle id="button21" class='bg' cx="16" cy="16" r="15" filter="url(#shadow)" />
                                <circle id="button22" class='bg' cx="16" cy="16" r="15" opacity='0.7'
                                    filter="url(#light)" />
                                <text class="textbutton" x="16" y="26" filter="url(#emboss)">2</text>
                            </g>

                            <g id="button_3" transform="translate(236,220)" onclick="alert('Button 3');"
                                onmouseover="changecolor(button31,button32,'#2F65FF');"
                                onmouseout="changecolor(button31,button32,'#608B98');">
                                <circle cx='17' cy='18' r='16' fill='#FFF' />
                                <circle id="button31" class='bg' cx="16" cy="16" r="15" filter="url(#shadow)" />
                                <circle id="button32" class='bg' cx="16" cy="16" r="15" opacity='0.7'
                                    filter="url(#light)" />
                                <text class="textbutton" x="16" y="26" filter="url(#emboss)">3</text>
                            </g>

                            <g id="button_4" transform="translate(281,220)" onclick="alert('Button 4');"
                                onmouseover="changecolor(button41,button42,'#2F65FF');"
                                onmouseout="changecolor(button41,button42,'#608B98');">
                                <circle cx='17' cy='18' r='16' fill='#FFF' />
                                <circle id="button41" class='bg' cx="16" cy="16" r="15" filter="url(#shadow)" />
                                <circle id="button42" class='bg' cx="16" cy="16" r="15" opacity='0.7'
                                    filter="url(#light)" />
                                <text class="textbutton" x="16" y="26" filter="url(#emboss)">4</text>
                            </g>

                            <g id="button_5" transform="translate(326,220)" onclick="alert('Button 5');"
                                onmouseover="changecolor(button51,button52,'#2F65FF');"
                                onmouseout="changecolor(button51,button52,'#608B98');">
                                <circle cx='17' cy='18' r='16' fill='#FFF' />
                                <circle id="button51" class='bg' cx="16" cy="16" r="15" filter="url(#shadow)" />
                                <circle id="button52" class='bg' cx="16" cy="16" r="15" opacity='0.7'
                                    filter="url(#light)" />
                                <text class="textbutton" x="16" y="26" filter="url(#emboss)">5</text>
                            </g>

                            <g id="button_Q" transform="translate(371,220)" onclick="alert('Button Q');"
                                onmouseover="changecolor(buttonQ1,buttonQ2,'#2F65FF');"
                                onmouseout="changecolor(buttonQ1,buttonQ2,'#B93D3D');">
                                <circle cx='17' cy='18' r='16' fill='#FFF' />
                                <circle id="buttonQ1" class='bg2' cx="16" cy="16" r="15" filter="url(#shadow)" />
                                <circle id="buttonQ2" class='bg2' cx="16" cy="16" r="15" opacity='0.7'
                                    filter="url(#light)" />
                                <text class="textbutton" x="16" y="26" filter="url(#emboss)">?</text>
                            </g>

                        </g>
                    </svg>
                </div>
                <div id="status">
                    <table id="tpossts">
                        <tbody>
                            <tr>
                                <td class='lposinfo'>X:</td>
                                <td id='posx'>???.??</td>
                                <td class='lposinfo'>Y:</td>
                                <td id='posy'>???.??</td>
                                <td class='lposinfo'>Z:</td>
                                <td id='posz'>???.??</td>
                            </tr>
                        </tbody>
                    </table>
                    <table id="ttempsts">
                        <tbody>
                            <tr id="trtempsts">
                                <td>
                                    <svg width="20" height="20">
                                        <g id="ext1">
                                            <rect x="0" y="0" width="24" height="24" fill="#FFF"></rect>
                                            <path id="e11" d="M1,0 L8,0 L8,15 L4.5,21 L1,15 z"
                                                style="fill: rgb(0, 0, 0);">
                                            </path>
                                            <text id="e12" x="10" y="15.5" class="slide"
                                                style="fill: rgb(0, 0, 0);">1</text>
                                        </g>
                                    </svg>
                                </td>
                                <td id='tdt0temp'>???.?? / ???.??</td>
                                <td>
                                    <svg width="30" height="20">
                                        <g id="bed">
                                            <rect x="0" y="0" width="24" height="24" fill="#FFF"></rect>
                                            <polygon id="b1" points="5,0 24,0 28,19 1,19" fill="none" stroke="#000000"
                                                stroke-width="2" style="stroke: rgb(0, 0, 0);"></polygon>
                                            <line id="b2" x1="11" y1="0" x2="10" y2="19" stroke="#000000"
                                                stroke-width="2" style="stroke: rgb(0, 0, 0);"></line>
                                            <line id="b3" x1="18" y1="0" x2="19" y2="19" stroke="#000000"
                                                stroke-width="2" style="stroke: rgb(0, 0, 0);"></line>
                                            <line id="b4" x1="3" y1="13" x2="26" y2="13" stroke="#000000"
                                                stroke-width="2" style="stroke: rgb(0, 0, 0);"></line>
                                            <line id="b5" x1="4" y1="6" x2="25" y2="6" stroke="#000000" stroke-width="2"
                                                style="stroke: rgb(0, 0, 0);">
                                            </line>
                                        </g>
                                    </svg>
                                </td>
                                <td id='tdbedtemp'>???.?? / ???.??</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id="userinp">
                    <table id="tuserinp">
                        <tbody>
                            <tr id="truserinp">
                                <td id="tddesc"><label>E0 Temp:[&#8451;]</label></td>
                                <td><input class='iucmd' type="number" id="iextrtemp" min="0" max="320" value="190"
                                        onkeyup="sendOnEnter(event,'e0')"></td>
                                <td><button onclick="sendVariantCmd('e0')">S</button></td>
                                <td><button onclick="sendVariantCmd('e0Off')">O</button></td>
                            </tr>
                            <tr id="truserinp">
                                <td id="tddesc"><label>Bed Temp:[&#8451;]</label></td>
                                <td><input class='iucmd' type="number" name="" id="ibedtemp" min="0" max="130"
                                        value="50" onkeyup="sendOnEnter(event, 'bed')"></td>
                                <td><button onclick="sendVariantCmd('bed')">S</button></td>
                                <td><button onclick="sendVariantCmd('bedOff')">O</button></td>
                            </tr>
                            <tr id="truserinp">
                                <td id="tddesc"><label>Fan Speed[%]:</label></td>
                                <td><input class='iucmd' type="number" name="" id="ifan0" min="0" max="100" value="100"
                                        onkeyup="sendOnEnter(event, 'fan')"></td>
                                <td><button onclick="sendVariantCmd('fan')">S</button></td>
                                <td><button onclick="sendVariantCmd('fanOff')">O</button></td>
                            </tr>
                            <tr id="truserinp">
                                <td id="tddesc"><label>Feed Rate[%]:</label></td>
                                <td><input class='iucmd' type="number" name="" id="ifeedrate" min="10" max="300"
                                        value="100" onkeyup="sendOnEnter(event, 'feedr')"></td>
                                <td><button onclick="sendVariantCmd('feedr')">S</button></td>
                            </tr>
                            <tr id="truserinp">
                                <td id="tddesc"><label>E0 Flow Rate[%]:</label></td>
                                <td><input class='iucmd' type="number" name="" id="iflowrate" min="10" max="300"
                                        value="100" onkeyup="sendOnEnter(event, 'flowr')"></td>
                                <td><button onclick="sendVariantCmd('flowr')">S</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div id='cmdarea' class="lockonprint">
                    <label>Manual Printer Command</label>
                    <textarea readonly id="cmdtext"></textarea>
                    <label for="icommand" id="lcommand">Command</label>
                    <input type="text" id="icommand" name="icommand" onkeyup="Command_OnEnter(event)">
                    <button id="cmdSendBtn" onclick="Command_Send('', true);">Send</button>
                </div>
            </div>
        </div>
        <div id="settingstab" class="tabcontent">
            <section class="settings-container">
                <div id="stats">
                    <div id="setting-header">Statistics</div>
                    <div id="setting-content">Stats stats stats</div>
                </div>
            </section>
            <section class="settings-container">
                <div id="otaupload">
                    <div id="setting-header">Firmware Upload</div>
                    <div id="setting-content">
                        <form method='POST' name='fwuploadform' enctype='multipart/form-data' id='fwuploadfrm'>
                            <input type='file' name='fwuserfile' accept='.bin' id='fwinpfile' onchange='sub(this, lfwInputFile)'>
                            <div style="text-align: center;">
                                <label id='lfwinpfile' for='fwinpfile'>Browse</label>
                            </div>
                            <input type='submit' value='Update' id="fwinput">
                            <br><br/>
                            <div id='fwprgtxt'></div>
                            <div id='fwprgbar'>
                                <div id='fwiprgbar'> </div>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
            <section class="settings-container">
                <div id="storage">
                    <div id="setting-header">Storage Information</div>
                    <div id="setting-content">Storage Storage Storage</div>
                </div>
            </section>
        </div>
        <div id="abouttab" class="tabcontent">
            <h3>About is TBD</h3>
        </div>
    </div>

    <script>
        var jsonFiles;
        var websock;

        const fwUploadForm = document.getElementById('fwuploadfrm');
        const lfwInputFile = document.getElementById('lfwinpfile');
        const fwInputFile = document.getElementById('fwinpfile');
        const fwProgTxt = document.getElementById('fwprgtxt');
        const fwProgBar = document.getElementById('fwiprgbar');

        fwUploadForm.addEventListener('submit', uploadFw);

        const textArea = document.getElementById('cmdtext');
        const cmdText = document.getElementById('icommand');

        const uploadForm = document.getElementById('uploadfrm');
        const inputFile = document.getElementById('inpfile');
        const progTxt = document.getElementById('prgtxt');
        const progBar = document.getElementById('iprgbar');
        const lInputFile = document.getElementById('linpfile');

        const tSdFiles = document.getElementById('tfiles');
        const tbSdFiles = document.getElementById('tbody');
        const sdFileDiv = document.getElementById('sdfiles');

        const inE0Temp = document.getElementById('iextrtemp');
        const inBedTemp = document.getElementById('ibedtemp');
        const inFan0Spd = document.getElementById('ifan0');
        const inFeedRate = document.getElementById('ifeedrate');
        const inFlowRate = document.getElementById('iflowrate');

        const tdE0Temp = document.getElementById('tdt0temp');
        const tdBedTemp = document.getElementById('tdbedtemp');

        const tdXPos = document.getElementById('posx');
        const tdYPos = document.getElementById('posy');
        const tdZPos = document.getElementById('posz');

        const lStateInf = document.getElementById('lprintersts');
        const lPrintPrg = document.getElementById('lprintprg');
        const pbPrint = document.getElementById('prinprg');

        uploadForm.addEventListener('submit', uploadFile);

        document.addEventListener('DOMContentLoaded', function () {
            initws();
            getDirs();
        }, false);
        window.onbeforeunload = function() {
            websock.onclose = function () {}; // disable onclose handler first
            websock.close();
        };
        function Command_OnEnter(ev) {
            if (ev.key === "Enter") {
                ev.preventDefault();
                Command_Send('', true);
            }
        }

        function initws() {
            textArea.value = "";
            websock = new WebSocket('ws://' + window.location.hostname + '/ws');
            websock.onerror = function (evt) {
                alert("WS Fail" + evt);
            }
            ws.onclose = function(){
                websock = null;
                setTimeout(function(){start(websocketServerLocation)}, 1000);
            };
            websock.onmessage = function (evt) {
                processWs(evt)
            };
        }

        function uploadFw(ev) {
            ev.preventDefault();
            fwProgTxt.style.color = '#777';
            if (fwInputFile.files.length === 0) {
                fwProgTxt.innerHTML = 'Choose a file first';
                fwProgTxt.style.color = 'red';
                return;
            }

            var xhr = new window.XMLHttpRequest();
            var formData = new FormData();

            xhr.upload.onprogress = function(ev) {
                if (ev.lengthComputable) {
                    var per = ev.loaded / ev.total;
                    fwProgTxt.innerHTML = 'Progress: ' + Math.round(per * 100) + '%';
                    fwProgBar.style.width = Math.round(per * 100) + '%';
                }
            }
            xhr.onloadend = function() {
                if (xhr.status == 200) {
                    fwProgTxt.innerHTML = 'Upload OK. ESP will reset in a moment...'
                    fwProgTxt.style.color = 'green';
                } else {
                    fwProgTxt.innerHTML = 'Upload Failed'
                    fwProgTxt.style.color = 'red';
                }
            };
            var frmData = new FormData();
            frmData.append('fwuserfile', fwInputFile.files[0])

            xhr.open('POST', '/fwupload', true);
            xhr.send(frmData);
        }

        function sub(obj, item) {
            var fileName = obj.value.split('\\');
            item.style.textAlign = 'left';
            item.innerHTML = '   ' + fileName[fileName.length - 1];
        };

        /* PS=PrintingPG=10PR=X:154.78 Y:115.00 Z:16.02 E:0.00 Count X:12382 Y:9200 Z:6407 */
        function processWs(ev) {
            var divs = document.getElementsByClassName('lockonprint');
            wsdata = ev.data;

            var prntState;
            var prntPerc;
            var serialReply;

            var psIdx = wsdata.indexOf('PS=');
            if (psIdx > -1) {
                psIdx += 3;
                var pgIdx = wsdata.indexOf('PG=', psIdx);

                if (pgIdx > -1) {
                    prntState = wsdata.substring(psIdx, pgIdx).trim();
                    pgIdx += 3
                    var prIdx = wsdata.indexOf('PR=', pgIdx);

                    if (prIdx > -1) {
                        prntPerc = wsdata.substring(pgIdx, prIdx);
                        prIdx += 3;
                        serialReply = wsdata.substring(prIdx);
                    }
                }
            }

            lStateInf.innerText = prntState;

            if ((prntState == 'Not Connected') || (prntState == 'Print Cancelled')) {
                lStateInf.style.color = "red";
            }
            else {
                lStateInf.style.color = "green"
            }

            if (prntState == 'Printing') {
                for (i = 0; i < divs.length; i++) {
                    divs[i].style.pointerEvents = "none";
                }

                var progdiv = document.getElementById('printprogress');
                progdiv.style.display = 'block';
                document.getElementById("abortbtn").style.display = "block";
                lPrintPrg.style.display = "block";
                document.getElementById('printprogress').style.display = "block";
                lPrintPrg.innerText = 'Printing: ' + prntPerc + '%';
                pbPrint.value = prntPerc;
            }
            else {
                for (i = 0; i < divs.length; i++) {
                    divs[i].style.pointerEvents = "all";
                }
                document.getElementById("abortbtn").style.display = "none";
                document.getElementById('printprogress').style.display = "none";
                lPrintPrg.style.display = "none";
            }


            if ('' !== serialReply) {
                if (true === updateTemperature(serialReply)) {
                    return;
                }
                else if (true == updatePosition(serialReply)) {
                    return;
                }

                textArea.value += serialReply;
                textArea.value += '\n';
                textArea.scrollTop = textArea.scrollHeight
            }
        }

        function abortPrint() {
            if (confirm("Cancel printing ?")) {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {

                    }
                }
                xhr.open("GET", "/abortPrint", true);
                xhr.send();
            }
        }
        /* T:110.03 /190.00 B:50.68 /0.00 @:0 B@:0 W:? */
        function updateTemperature(text) {
            var retVal = false;
            var re = /(B|T(\d*)):\s*([+]?[0-9]*\.?[0-9]+)? (\/)([+]?[0-9]*\.?[0-9]+)?/gi;
            while ((result = re.exec(text)) !== null) {
                if (result[1] == 'T') {
                    tdE0Temp.innerText = result[3] + 'C' + " \\ " + result[5] + 'C';
                }
                else if (result[1] == 'B') {
                    tdBedTemp.innerText = result[3] + 'C' + " \\ " + result[5] + 'C';
                    retVal = true;
                }
            }
            return retVal;
        }
        /* X:154.78 Y:115.00 Z:16.21 E:0.00 Count X:12382 Y:9200 Z:6485 */
        function updatePosition(text) {
            xVal = extractValue('X:', text);
            yVal = extractValue('Y:', text);
            zVal = extractValue('Z:', text);
            tdXPos.innerText = xVal;
            tdYPos.innerText = yVal;
            tdZPos.innerText = zVal;

            if (xVal !== "???" || yVal !== "???" || zVal != "???") {
                return true;
            }
            else {
                return false;
            }
        }

        function extractValue(axis, text) {
            var axisIdx = text.indexOf(axis);
            if (axisIdx > -1) {
                axisIdx += axis.length;
                var spaceIdx = text.indexOf(' ', axisIdx);
                if (spaceIdx > -1) {
                    return text.substring(axisIdx, spaceIdx).trim();
                }
                else {
                    return text.substring(axisIdx).trim();
                }
            }
            else {
                return "???";
            }
        }

        function uploadFile(ev) {
            ev.preventDefault();
            progTxt.style.color = '#777';
            if (inputFile.files.length === 0) {
                progTxt.innerHTML = 'Choose a file first!';
                progTxt.style.color = 'red';
                return;
            }
            var xhr = new window.XMLHttpRequest();
            xhr.upload.onprogress = function (ev) {
                if (ev.lengthComputable) {
                    var per = ev.loaded / ev.total;
                    progTxt.innerHTML = 'Progress: ' + Math.round(per * 100) + '%';
                    progBar.style.width = Math.round(per * 100) + '%';
                }
            }
            xhr.onloadend = function () {
                if (xhr.status == 200) {
                    progTxt.innerHTML = 'Success'
                    progTxt.style.color = 'green';
                    getDirs();
                } else {
                    progTxt.innerHTML = 'Upload Failed'
                    progTxt.style.color = 'red';
                }
            };
            var frmData = new FormData();
            frmData.append('userfile', inputFile.files[0])

            xhr.open('POST', '/', true);
            xhr.send(frmData);
        };

        function getDirs() {

            // var text = '{"files":[{"filename":"/gcode/100mm_level_block.gcode","size":"559276"},{"filename":"/gcode/arms2_single_0.36mm_PLA_ENDER3_8m.gcode","size":"273602"},{"filename":"/gcode/fanmount-40x40x20mm-threaded.gcode","size":"914558"},{"filename":"/gcode/HamsterWheel_10cm.gcode","size":"7877858"},{"filename":"/gcode/myProbe.gcode","size":"1262694"},{"filename":"/gcode/one_gear_no_center_0.36mm_PLA_ENDER3_18m.gcode","size":"1073455"}]}';
            // // var text = '{"files":[{"filename":"/gcode/100mm_level_block.gcode","size":"559276"}]}';
            // jsonFiles = JSON.parse(text);

            // createTable(jsonFiles.files, tbSdFiles);

            // tSdFiles.style.display = "table";

            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/dirs", true);
            xhr.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {

                    jsonFiles = JSON.parse(this.responseText);

                    createTable(jsonFiles.files, tbSdFiles);
                    tSdFiles.style.display = "table";
                }
            }
            xhr.send();
        }

        function createTable(array, table) {
            // remove all the existing table data
            for (var i = table.rows.length - 1; i >= 0; i--) {
                table.deleteRow(i);
            }
            var tableBody = "";
            for (var i = 0; i < array.length; i++) {
                let size = parseInt(array[i].size) / 1048576;
                size = size.toFixed(2) + " MB";

                tableBody += "<tr id='filestr'>";
                tableBody += "<td id='tdname'>" + array[i].filename + "</td>";
                tableBody += "<td id='tdprint' onclick=\"requestPrint('" + array[i].filename + "')\">";
                tableBody += "<svg width='1em' heigth='1em' viewbox='0 0 1300 1200'>";
                tableBody += "<g transform='translate(30,1200) scale(1,-1)'>";
                tableBody += "<path fill='currentColor' d='M822 1200h-444q-11 0 -19 -7.5t-9 -17.5l-78 -301q-7 -24 7 -45l57 -108q6 -9 17.5 -15t21.5 -6h450q10 0 21.5 6t17.5 15l62 108q14 21 7 45l-83 301q-1 10 -9 17.5t-19 7.5zM1175 800h-150q-10 0 -21 -6.5t-15 -15.5l-78 -156q-4 -9 -15 -15.5t-21 -6.5h-550 q-10 0 -21 6.5t-15 15.5l-78 156q-4 9 -15 15.5t-21 6.5h-150q-10 0 -17.5 -7.5t-7.5 -17.5v-650q0 -10 7.5 -17.5t17.5 -7.5h150q10 0 17.5 7.5t7.5 17.5v150q0 10 7.5 17.5t17.5 7.5h750q10 0 17.5 -7.5t7.5 -17.5v-150q0 -10 7.5 -17.5t17.5 -7.5h150q10 0 17.5 7.5 t7.5 17.5v650q0 10 -7.5 17.5t-17.5 7.5zM850 200h-500q-10 0 -19.5 -7t-11.5 -17l-38 -152q-2 -10 3.5 -17t15.5 -7h600q10 0 15.5 7t3.5 17l-38 152q-2 10 -11.5 17t-19.5 7z'/>";
                tableBody += '</g></svg></td>';
                tableBody += "<td id='tdsize'>" + size + "</td>";
                tableBody += "<td id='tddelete' onclick=\"requestDelete('" + array[i].filename + "')\">Delete</td>";
                tableBody += "</tr>";
            }
            table.innerHTML += tableBody;
        }

        function requestPrint(name) {
            if (confirm("Start printing: " + name + " ?")) {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                    }
                }
                xhr.open("GET", "/request?printFile=" + name, true);
                xhr.send();
            }
        }

        function requestDelete(name) {
            if (confirm("Delete file: " + name + " ?")) {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        getDirs();
                    }
                }
                xhr.open("GET", "/request?deletef=" + name, true);
                xhr.send();
            }
        }

        function reqStats() {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    textArea.value += "ReqStats OK";
                    textArea.value += '\n';
                }
            }
            xhr.open("GET", "/stats", true);
            xhr.send();
        }

        function Command_Send(cmd, lecho) {
            var xhr = new XMLHttpRequest();
            if (lecho == true) {
                printerCmd = cmdText.value;
                xhr.onreadystatechange = function () {
                    cmdStateChange(this);
                }
                cmdText.value = "";
            }
            else { printerCmd = cmd; }
            if (printerCmd != "") {
                xhr.open("GET", "/request?gcodecmd=" + printerCmd, true);
                xhr.send();
            }
        }

        function relMvCmd(where) {
            var cmd = 'G91%0AG1 ' + where + "%0AM114%0AG90"
            Command_Send(cmd, false);
        }

        function sendOnEnter(ev, type) {
            if (ev.keyCode == 13) {
                sendVariantCmd(type);
            }
            return true;
        }

        function sendVariantCmd(type) {
            var cmd;
            switch (type) {
                case 'e0':
                    cmd = 'M104 S' + inE0Temp.value + ' T0';
                    break;
                case 'e0Off':
                    cmd = 'M104 S0 T0';
                    break;
                case 'bed':
                    cmd = 'M140 S' + inBedTemp.value;
                    break;
                case 'bedOff':
                    cmd = 'M140 S0';
                    break;
                case 'fan':
                    cmd = 'M106 P0 S' + inFan0Spd.value;
                    break;
                case 'fanOff':
                    cmd = 'M107';
                    break;
                case 'feedr':
                    cmd = 'M220' + inFeedRate.value;
                    break;
                case 'flowr':
                    cmd = 'M221 S' + inFlowRate.value + ' T0';
                    break;
                default:
                    cmd = "";
                    break;
            }
            if (cmd !== '') {
                var xhr = new XMLHttpRequest();
                xhr.open("GET", "/request?masterCmd=" + cmd, true);
                xhr.send();
            }
        }

        function cmdStateChange(ev) {
            if (ev.readyState == 4 && ev.status != 200) {
                textArea.value += "Request Failed";
                textArea.value += '\n';
            } else if (ev.readyState == 4 && ev.status == 200) {
                textArea.value += printerCmd;
                textArea.value += '\n';
            }
        }

        function openPage(pageName, elmnt, color) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            tablinks = document.getElementsByClassName("tablink");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].style.backgroundColor = "";
            }

            document.getElementById(pageName).style.display = "block";
            elmnt.style.backgroundColor = color;
        }

        function restore_x(e) {
            centerxytext.textContent = 'X/Y';
            show_hide(e, 0)
        }

        function changecolor() {
            if (isDown) return;
            var len = arguments.length;
            if (len < 2) return;
            var color = arguments[len - 1];
            for (var i = 0; i < len - 1; i++) {
                arguments[i].style.fill = color;
            }
        }

        function changestroke() {
            if (isDown) return;
            var len = arguments.length;
            if (len < 2) return;
            var color = arguments[len - 1];
            for (var i = 0; i < len - 1; i++) {
                arguments[i].style.stroke = color;
            }
        }

        function restore_z(e) {
            centerztext.textContent = 'Z';
            show_hide(e, 0);
        }

        function restore_e(e) {
            show_hide(extruder, 1);
            show_hide(centeretext, 0);
            show_hide(e, 0);
        }

        function settext_e(text, e) {
            if (isDown) return;
            show_hide(extruder, 0);
            centeretext.textContent = text;
            show_hide(centeretext, 1);
            show_hide(e, 0.5);
        }

        function show_hide(e, show) {
            e.style.opacity = show;
        }

        function settext_x(text, e) {
            if (isDown) return;
            centerxytext.textContent = text;
            show_hide(e, 0.5)
        }

        function settext_z(text, e) {
            if (isDown) return;
            centerztext.textContent = text;
            show_hide(e, 0.5);
        }

        //range functions
        var offset = 0;
        var isDown = false;
        var active_control = null;

        document.addEventListener('mouseup', function () {
            isDown = false;
        }, true);

        //position is based on screen position value
        function movethumb(pos) {
            var p = pos + offset;
            var minpos = 0;
            var maxpos = 0;
            var minvalue = 0;
            var maxvalue = 100;
            var value = 0;
            var rangeelement = null;
            if (active_control.hasAttribute('customrange')) {
                rangeelement = document.getElementById(active_control.getAttribute('customrange'));
                var r = rangeelement.getBoundingClientRect();
                minpos = r.left;
                maxpos = r.right;
                if (rangeelement.hasAttribute('min')) {
                    minvalue = parseFloat(rangeelement.getAttribute('min'))
                }
                if (rangeelement.hasAttribute('max')) {
                    maxvalue = parseFloat(rangeelement.getAttribute('max'))
                }
            }
            var r2 = active_control.getBoundingClientRect();
            if (p > maxpos - (r2.right - r2.left)) p = maxpos - (r2.right - r2.left);
            if (p < minpos) p = minpos;
            active_control.style.left = p + 'px';
            if (active_control.hasAttribute('render')) {
                value = (((p - minpos) * (maxvalue - minvalue)) / ((maxpos - minpos) - (r2.right - r2.left)))
                document.getElementById(active_control.getAttribute('render')).value = Math.round(value + minvalue);
            }
        }

        //position is based on range value
        function movethumbat(thumbcursor, value) {
            var minvalue = 0;
            var maxvalue = 100;
            var minpos = 0;
            var maxpos = 0;
            var rangeelement = null;
            if (thumbcursor.hasAttribute('customrange')) {
                rangeelement = document.getElementById(thumbcursor.getAttribute('customrange'));
                var r = rangeelement.getBoundingClientRect();
                minpos = r.left;
                maxpos = r.right;
                if (rangeelement.hasAttribute('min')) {
                    minvalue = parseFloat(rangeelement.getAttribute('min'))
                }
                if (rangeelement.hasAttribute('max')) {
                    maxvalue = parseFloat(rangeelement.getAttribute('max'))
                }
            }
            if (value > maxvalue) value = maxvalue;
            if (value < minvalue) value = minvalue;
            var r2 = thumbcursor.getBoundingClientRect();
            var pos = 0;
            pos = ((value - minvalue) * ((maxpos - minpos) - (r2.right - r2.left)) / (maxvalue - minvalue)) + minpos;
            thumbcursor.style.left = pos + 'px';
            if (thumbcursor.hasAttribute('render')) {
                document.getElementById(thumbcursor.getAttribute('render')).value = value;
            }
        }

        document.addEventListener('mousemove', function (event) {
            //event.preventDefault();
            if (isDown) {
                movethumb(event.clientX);
            }
        }, true);

        function rangeclicked(event, element) {

            if (element.hasAttribute('customthumb')) {
                active_control = document.getElementById(element.getAttribute('customthumb'));
                offset = 0;
                movethumb(event.clientX);
            }
        }

        function initthumb(element) {
            element.addEventListener('mousedown', function (e) {
                isDown = true;
                offset = element.offsetLeft - e.clientX;
                active_control = this;
            }, true);
            if (element.hasAttribute('bgimage')) {
                element.innerHTML = element.getAttribute('bgimage');
            }
            if (element.hasAttribute('customrange')) {
                var r = document.getElementById(element.getAttribute('customrange')).getBoundingClientRect();
                element.style.top = r.top;
                element.style.left = r.left;
            }
        }

        function initrange(element) {
            if (element.hasAttribute('bgimage')) {
                element.innerHTML = element.getAttribute('bgimage');
            }
        }

        // Get the element with id="defaultOpen" and click on it
        document.getElementById("defaultOpen").click();

        // extruderlist.style.left = "960px";
        // var rb = positionbar.getBoundingClientRect();
        // var re = extruderlist.getBoundingClientRect();
        // extruderlist.style.top = rb.top + (((rb.bottom - rb.top) - (re.bottom - re.top)) / 2) + 15 + "px";

        // initrange(rangefeedrate);
        // initthumb(thumbfeedrate);
        // initrange(rangeflowrate);
        // initthumb(thumbflowrate);
        // initrange(rangefanspeed);
        // initthumb(thumbfanspeed);
        // initrange(rangebed);
        // initthumb(thumbbed);
        // initrange(rangeext1);
        // initthumb(thumbext1);
        // initrange(rangeext2);
        // initthumb(thumbext2);
    </script>
</body>

</html>